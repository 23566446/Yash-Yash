<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>YashYash | ç™¼èµ·ææ¡ˆ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <div class="wabi-card">
            <h3>ç™¼èµ·æ–°çš„æ—…è¡Œææ¡ˆ</h3>
            <div class="form-group">
                <label>é–‹å§‹æ—¥æœŸ</label>
                <input type="date" id="start-date">
                <label>çµæŸæ—¥æœŸ</label>
                <input type="date" id="end-date">
                <label>æœ€ä½æˆè¡Œäººæ•¸</label>
                <input type="number" id="min-ppl" value="2" min="1">
                
                <div class="actions" style="margin-top: 20px;">
                    <button onclick="location.href='index.html'" class="btn-text">å–æ¶ˆ</button>
                    <button onclick="submitProposal()" class="btn-primary">ç™¼å¸ƒææ¡ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    const API_URL = 'http://localhost:3000';
    async function submitProposal() {
        const startDate = document.getElementById('start-date').value;
        const endDate = document.getElementById('end-date').value;
        const minPpl = document.getElementById('min-ppl').value;
        
        if (!startDate || !endDate) {
            alert("ğŸš¨ è«‹å®Œæ•´å¡«å¯«é–‹å§‹èˆ‡çµæŸæ—¥æœŸï¼");
            return;
        }

        if (new Date(endDate) < new Date(startDate)) {
            alert("ğŸš¨ çµæŸæ—¥æœŸä¸èƒ½æ—©æ–¼é–‹å§‹æ—¥æœŸå–”ï¼");
            return;
        }

        const user = JSON.parse(localStorage.getItem('yashyash_user'));
        
        const payload = {
            creator: user.nickname, // ç”¨æ–¼é¡¯ç¤ºçš„åç¨±
            start: startDate,
            end: endDate,
            min: parseInt(minPpl),
            // --- æ ¸å¿ƒä¿®æ­£ï¼šåˆå§‹æŠ•ç¥¨äººå­˜å…¥å”¯ä¸€çš„ account è€Œä¸æ˜¯ nickname ---
            votes: [user.account], 
            status: 'voting'
        };

        try {
            const response = await fetch(`${API_URL}/api/proposals`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if(response.ok) {
                alert("âœ… ææ¡ˆå·²ç™¼å¸ƒåˆ°å…¬å‘Šæ¬„ï¼");
                location.href = 'index.html';
            } else {
                alert("ç™¼å¸ƒå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
            }
        } catch (err) {
            alert("ä¼ºæœå™¨é€£ç·šå¤±æ•—");
        }
    }
    </script>
</body>
</html>